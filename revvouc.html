<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pembukuan Voucher - Akuntansi</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 10px;
      background: #f9f9f9;
      color: #333;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    .section {
      background: white;
      padding: 15px;
      margin: 12px 0;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    h2, h3 { margin-top: 0; }
    input, select, button, textarea {
      margin: 6px 4px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      padding: 8px 16px;
    }
    button:hover { background: #0056b3; }
    button.danger { background: #dc3545; }
    button.danger:hover { background: #c82333; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #f1f1f1; }
    #loginScreen {
      max-width: 320px;
      margin: 60px auto;
      padding: 25px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    #modalAgen {
      display: none;
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
      z-index: 1000;
      width: 90%;
      max-width: 400px;
    }
    .readonly-cell {
      background: #f5f5f5;
      color: #666;
    }
    @media (max-width: 600px) {
      .section { padding: 12px; }
      input, select, button { font-size: 14px; padding: 6px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- LOGIN -->
    <div id="loginScreen">
      <h2>Login Pembukuan</h2>
      <input type="text" id="username" placeholder="Username" autocomplete="off" />
      <input type="password" id="password" placeholder="Password" />
      <button onclick="login()">Masuk</button>
      <p id="loginError" style="color: red; margin-top: 8px;"></p>
    </div>
    <!-- MAIN APP -->
    <div id="app" style="display: none;">
      <header style="display: flex; justify-content: space-between; align-items: center;">
        <h2 id="headerTitle">Pembukuan Voucher</h2>
        <button onclick="logout()">Logout</button>
      </header>
      <!-- PERIODE -->
      <div class="section">
        <label><strong>Periode:</strong></label>
        <select id="periodeSelect" onchange="loadPeriode()"></select>
        <button id="btnSetActive" onclick="setActivePeriode()" style="display:none;">Tetapkan sebagai Aktif</button>
        <button id="btnTambahPeriode" onclick="tambahPeriode()">+ Tambah Periode</button>
        <button id="btnBackup" onclick="backupData()">Backup</button>
      </div>
      <!-- CATATAN -->
      <div class="section">
        <h3>Catatan Penting</h3>
        <textarea id="catatan" rows="3" style="width: 100%;"></textarea>
        <button onclick="simpanCatatan()">Simpan Catatan</button>
      </div>
      <!-- STOK -->
      <div class="section">
        <h3>Stok Voucher</h3>
        <table>
          <tr><td>Stok Awal V3</td><td id="cellStokV3">0</td></tr>
          <tr><td>Stok Awal V5</td><td id="cellStokV5">0</td></tr>
          <tr><td>Stok yang telah di-drop V3</td><td id="dropV3">0</td></tr>
          <tr><td>Stok yang telah di-drop V5</td><td id="dropV5">0</td></tr>
          <tr><td><strong>Sisa Stok V3</strong></td><td id="sisaV3">0</td></tr>
          <tr><td><strong>Sisa Stok V5</strong></td><td id="sisaV5">0</td></tr>
        </table>
        <button id="btnSimpanStok" onclick="simpanStok()" style="display:none;">Simpan Stok Awal</button>
      </div>
      <!-- DAFTAR AGEN -->
      <div class="section">
        <h3>Daftar Agen</h3>
        <div id="daftarAgenList"></div>
        <button id="btnTambahAgen" onclick="tambahAgenForm()">+ Tambah Agen</button>
      </div>
      <!-- TRANSAKSI -->
      <div class="section">
        <h3>Transaksi</h3>
        <div>
          <h4>Pengambilan Voucher</h4>
          <select id="agenAmbil"><option value="">-- Pilih Agen --</option></select>
          <input type="date" id="tglAmbil" />
          <input type="number" id="v3Ambil" placeholder="Jumlah V3" min="0" />
          <input type="number" id="v5Ambil" placeholder="Jumlah V5" min="0" />
          <button onclick="simpanTransaksi('ambil')">Simpan Pengambilan</button>
        </div>
        <div style="margin-top: 15px;">
          <h4>Penyetoran</h4>
          <select id="agenSetor"><option value="">-- Pilih Agen --</option></select>
          <input type="date" id="tglSetor" />
          <input type="number" id="nominalSetor" placeholder="Nominal (Rp)" min="0" />
          <button onclick="simpanTransaksi('setor')">Simpan Penyetoran</button>
        </div>
        <!-- âœ… SUB FITUR TF BARU -->
        <div style="margin-top: 15px;">
          <h4>Transfer ke Global</h4>
          <input type="date" id="tglTf" />
          <input type="number" id="jumlahTf" placeholder="Jumlah Transfer (Rp)" min="0" />
          <button onclick="simpanTransaksi('tf')">Simpan TF</button>
        </div>
      </div>
      <!-- REKAP PER AGEN -->
      <div class="section">
        <h3>Rekap per Agen</h3>
        <table>
          <thead>
            <tr><th>Nama Agen</th><th>Total Pengambilan (Rp)</th><th>Total Setoran (Rp)</th><th>Sisa Utang (Rp)</th></tr>
          </thead>
          <tbody id="tbodyRekapAgen"></tbody>
        </table>
      </div>
      <!-- RIWAYAT TRANSAKSI DETAIL -->
      <div class="section">
        <h3>Riwayat Transaksi Detail</h3>
        <table>
          <thead>
            <tr>
              <th>Tanggal</th><th>Agen</th><th>Pengambilan</th><th>Penyetoran</th><th>V3</th><th>V5</th><th>Nominal</th><th>Aksi</th>
            </tr>
          </thead>
          <tbody id="tbodyRiwayat"></tbody>
          <tfoot>
            <tr>
              <td colspan="6"><strong>Total Keseluruhan</strong></td>
              <td id="totalAmbilFooter">Rp. 0</td>
              <td id="totalSetorFooter">Rp. 0</td>
            </tr>
          </tfoot>
        </table>
      </div>
      <!-- REKAP KESELURUHAN -->
      <div class="section">
        <h3>Rekap Keseluruhan</h3>
        <table>
          <tr><td>1. Total stok awal</td><td id="rek1">0</td></tr>
          <tr><td>2. Total yang belum diterima</td><td id="rek2">0</td></tr>
          <tr><td>3. Total yang sudah diterima dari agen</td><td id="rek3">0</td></tr>
          <tr><td>4. Total yang akan ditransfer ke Global</td><td id="rek4">0</td></tr>
          <tr><td>5. Total yang sudah ditransfer ke Global</td><td id="rek5">0</td></tr>
          <tr><td>6. Total sisa yang belum ditransfer</td><td id="rek6">0</td></tr>
          <tr><td>7. Total dana dalam bentuk barang</td><td id="rek7">0</td></tr>
        </table>
        <!-- Opsional: jika masih ingin simpan catatan lain, pertahankan tombol -->
        <!-- Tapi karena rek5 otomatis, tidak perlu simpan manual -->
      </div>
    </div>
    <!-- MODAL TAMBAH/EDIT AGEN -->
    <div id="modalAgen">
      <h3>Tambah/Edit Agen</h3>
      <input type="text" id="modalId" placeholder="ID (001)" maxlength="3" />
      <input type="text" id="modalNama" placeholder="Nama Agen" />
      <button onclick="simpanAgen()">Simpan</button>
      <button onclick="tutupModal()">Batal</button>
    </div>
  </div>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    // === FIREBASE CONFIG ===
    const firebaseConfig = {
      apiKey: "AIzaSyC45P_1xbNL8zi3e0aS4kHkIGvRvGEAmwM",
      authDomain: "takkoandi-8e99e.firebaseapp.com",
      databaseURL: "https://takkoandi-8e99e-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "takkoandi-8e99e",
      storageBucket: "takkoandi-8e99e.firebasestorage.app",
      messagingSenderId: "117264025083",
      appId: "1:117264025083:web:8102fe737f7783e1b7b75e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const HARGA_V3_AGEN = 2550;
    const HARGA_V5_AGEN = 4250;
    const HARGA_V3_GLOBAL = 2400;
    const HARGA_V5_GLOBAL = 4000;
    const AGEN_DEFAULT = {
      "001": "nani", "002": "rostini", "003": "mila", "004": "mira", "005": "mama arham",
      "006": "jusrawira", "007": "putri", "008": "ardila", "009": "sulaeman", "010": "ira",
      "011": "jusriadi", "012": "ricky", "013": "risman", "014": "afzal", "015": "rika",
      "016": "ayu", "017": "hasna", "018": "asnita", "019": "nisma", "020": "ennar",
      "021": "nailah", "022": "ady", "023": "radiah"
    };
    let currentUser = null;
    let currentPeriode = null;
    let globalActivePeriode = null;
    let agenCache = {};

    // === LOGIN ===
    function login() {
      const u = document.getElementById("username").value.trim();
      const p = document.getElementById("password").value;
      const valid = { andi: "1981", risman: "sahrul", anto: "afzal" };
      if (valid[u] === p) {
        currentUser = u;
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("app").style.display = "block";

        document.getElementById("btnTambahPeriode").style.display = "inline-block";
        document.getElementById("btnBackup").style.display = "inline-block";
        document.getElementById("btnTambahAgen").style.display = "inline-block";
        if (u !== "andi") {
          document.getElementById("btnTambahPeriode").style.display = "none";
          document.getElementById("btnBackup").style.display = "none";
          document.getElementById("btnTambahAgen").style.display = "none";
          document.getElementById("headerTitle").textContent = "Pembukuan Voucher (Pengguna)";
        }
        loadActivePeriodeSetting();
      } else {
        document.getElementById("loginError").textContent = "Username atau password salah";
      }
    }

    function logout() {
      currentUser = null;
      document.getElementById("loginScreen").style.display = "block";
      document.getElementById("app").style.display = "none";
    }

    // === BACA PERIODE AKTIF GLOBAL ===
    function loadActivePeriodeSetting() {
      db.ref("settings/active_periode").once("value", (snap) => {
        globalActivePeriode = snap.val() || null;
        loadPeriodeList();
      });
    }

    // === PERIODE ===
    function loadPeriodeList() {
      db.ref("periode_list").once("value", (snap) => {
        const list = snap.val() || [];
        const sel = document.getElementById("periodeSelect");
        sel.innerHTML = "";
        if (list.length === 0) return;

        const sortedList = list.map(Number).sort((a, b) => a - b).map(String);

        sortedList.forEach(p => {
          const opt = document.createElement("option");
          opt.value = p;
          if (currentUser === "andi") {
            opt.textContent = p;
            opt.disabled = false;
          } else {
            if (p === globalActivePeriode) {
              opt.textContent = p + " (Aktif)";
              opt.disabled = false;
            } else {
              opt.textContent = p + " ðŸ”’";
              opt.disabled = true;
            }
          }
          sel.appendChild(opt);
        });

        if (currentUser === "andi") {
          const last = localStorage.getItem("last_periode") || globalActivePeriode || sortedList[sortedList.length - 1];
          if (sortedList.includes(last)) {
            sel.value = last;
          } else {
            sel.value = globalActivePeriode || sortedList[sortedList.length - 1];
          }
          document.getElementById("btnSetActive").style.display = "inline-block";
        } else {
          sel.value = globalActivePeriode || sortedList[sortedList.length - 1];
        }

        currentPeriode = sel.value;
        loadPeriode();
      });
    }

    function setActivePeriode() {
      if (currentUser !== "andi") return;
      const selected = document.getElementById("periodeSelect").value;
      if (!selected) return alert("Pilih periode dulu!");
      db.ref("settings/active_periode").set(selected).then(() => {
        globalActivePeriode = selected;
        alert(`Periode ${selected} sekarang aktif untuk pengguna.`);
        loadPeriodeList();
      });
    }

    function tambahPeriode() {
      const p = prompt("Masukkan periode (angka, contoh: 202510):");
      if (!p || isNaN(p)) return;
      db.ref("periode_list").once("value", (snap) => {
        const list = snap.val() || [];
        if (!list.includes(p)) {
          list.push(p);
          db.ref("periode_list").set(list);
          db.ref(`data/${p}/agen`).set(AGEN_DEFAULT).then(() => {
            alert(`Periode ${p} berhasil dibuat.`);
            loadPeriodeList();
          });
        } else {
          alert("Periode sudah ada!");
        }
      });
    }

    function backupData() {
      if (!currentPeriode) return alert("Pilih periode dulu!");
      db.ref(`data/${currentPeriode}`).once("value", (snap) => {
        const data = snap.val();
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `backup_periode_${currentPeriode}.json`;
        a.click();
        URL.revokeObjectURL(url);
      });
    }

    function loadPeriode() {
      currentPeriode = document.getElementById("periodeSelect").value;
      if (!currentPeriode) return;

      if (currentUser === "andi") {
        localStorage.setItem("last_periode", currentPeriode);
      }

      db.ref(`data/${currentPeriode}/catatan`).once("value", s => {
        document.getElementById("catatan").value = s.val() || "";
      });

      db.ref(`data/${currentPeriode}/stok`).once("value", s => {
        const stok = s.val() || { v3: 0, v5: 0 };
        if (currentUser === "andi") {
          document.getElementById("cellStokV3").innerHTML = `<input type="number" id="stokV3" min="0" value="${stok.v3}" />`;
          document.getElementById("cellStokV5").innerHTML = `<input type="number" id="stokV5" min="0" value="${stok.v5}" />`;
          document.getElementById("btnSimpanStok").style.display = "inline-block";
        } else {
          document.getElementById("cellStokV3").textContent = stok.v3;
          document.getElementById("cellStokV5").textContent = stok.v5;
          document.getElementById("cellStokV3").className = "readonly-cell";
          document.getElementById("cellStokV5").className = "readonly-cell";
          document.getElementById("btnSimpanStok").style.display = "none";
        }
      });

      // âŒ Tidak perlu baca rekap_manual untuk rek5 lagi
      // Karena rek5 sekarang otomatis dari TF

      db.ref(`data/${currentPeriode}/agen`).once("value", (snap) => {
        agenCache = snap.val() || {};
        renderDaftarAgen();
        isiDropdownAgen();
        loadAllData();
      });
    }

    function renderDaftarAgen() {
      const div = document.getElementById("daftarAgenList");
      div.innerHTML = "<ul style='padding-left:20px;'>";
      Object.keys(agenCache).sort().forEach(id => {
        div.innerHTML += `<li>${id} = ${agenCache[id]}</li>`;
      });
      div.innerHTML += "</ul>";
    }

    function isiDropdownAgen() {
      const agenList = Object.entries(agenCache).map(([id, nama]) => ({ id, nama }));
      ["agenAmbil", "agenSetor"].forEach(id => {
        const sel = document.getElementById(id);
        sel.innerHTML = '<option value="">-- Pilih Agen --</option>';
        agenList.forEach(a => {
          const opt = document.createElement("option");
          opt.value = a.id;
          opt.textContent = a.nama;
          sel.appendChild(opt);
        });
      });
    }

    function simpanStok() {
      if (currentUser !== "andi") return;
      const v3 = parseInt(document.getElementById("stokV3").value) || 0;
      const v5 = parseInt(document.getElementById("stokV5").value) || 0;
      db.ref(`data/${currentPeriode}/stok`).set({ v3, v5 });
      loadAllData();
    }

    function simpanCatatan() {
      db.ref(`data/${currentPeriode}/catatan`).set(document.getElementById("catatan").value);
    }

    function tambahAgenForm() {
      document.getElementById("modalId").value = "";
      document.getElementById("modalNama").value = "";
      document.getElementById("modalAgen").style.display = "block";
    }

    function simpanAgen() {
      let id = document.getElementById("modalId").value.trim();
      const nama = document.getElementById("modalNama").value.trim();
      if (!id || !nama) return alert("ID dan Nama harus diisi");
      id = id.padStart(3, "0");
      db.ref(`data/${currentPeriode}/agen/${id}`).set(nama).then(() => {
        agenCache[id] = nama;
        renderDaftarAgen();
        isiDropdownAgen();
        tutupModal();
      });
    }

    function tutupModal() {
      document.getElementById("modalAgen").style.display = "none";
    }

    function simpanTransaksi(jenis) {
      let data = { jenis };
      if (jenis === "ambil") {
        const agen = document.getElementById("agenAmbil").value;
        const v3 = parseInt(document.getElementById("v3Ambil").value) || 0;
        const v5 = parseInt(document.getElementById("v5Ambil").value) || 0;
        const tgl = document.getElementById("tglAmbil").value || new Date().toISOString().split("T")[0];
        if (!agen || (v3 === 0 && v5 === 0)) return alert("Pilih agen dan isi V3/V5");
        data.agen = agen;
        data.v3 = v3;
        data.v5 = v5;
        data.tgl = tgl;
        data.nominal = v3 * HARGA_V3_AGEN + v5 * HARGA_V5_AGEN;
      } else if (jenis === "setor") {
        const agen = document.getElementById("agenSetor").value;
        const nominal = parseInt(document.getElementById("nominalSetor").value) || 0;
        const tgl = document.getElementById("tglSetor").value || new Date().toISOString().split("T")[0];
        if (!agen || nominal <= 0) return alert("Pilih agen dan isi nominal");
        data.agen = agen;
        data.tgl = tgl;
        data.nominal = nominal;
      } else if (jenis === "tf") {
        // âœ… TRANSFER BARU
        const tglTf = document.getElementById("tglTf").value;
        const jumlahTf = parseInt(document.getElementById("jumlahTf").value) || 0;
        if (!tglTf || jumlahTf <= 0) return alert("Isi tanggal dan jumlah transfer");
        data.tgl = tglTf;
        data.nominal = jumlahTf; // simpan sebagai nominal untuk konsistensi
      } else {
        return;
      }
      db.ref(`data/${currentPeriode}/transaksi`).push(data);
      resetFormTransaksi();
      loadAllData();
    }

    function resetFormTransaksi() {
      ["v3Ambil", "v5Ambil", "nominalSetor", "jumlahTf"].forEach(id => {
        document.getElementById(id).value = "";
      });
      // Reset tanggal juga (opsional)
      document.getElementById("tglTf").value = "";
    }

    function loadAllData() {
      if (!currentPeriode) return;
      db.ref(`data/${currentPeriode}/transaksi`).on("value", (snap) => {
        const trans = snap.val() || {};
        const tbodyR = document.getElementById("tbodyRiwayat");
        const tbodyA = document.getElementById("tbodyRekapAgen");
        tbodyR.innerHTML = "";
        tbodyA.innerHTML = "";
        const agenMap = {};
        let totalPengambilan = 0;
        let totalSetoran = 0;
        let totalTf = 0; // âœ… total transfer
        let totalV3 = 0, totalV5 = 0;

        Object.entries(trans).forEach(([key, t]) => {
          const ambil = t.jenis === "ambil";
          const setor = t.jenis === "setor";
          const tf = t.jenis === "tf";
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${t.tgl}</td>
            <td>${tf ? "TRANSFER" : (agenCache[t.agen] || t.agen)}</td>
            <td>${ambil ? "BENAR" : "X"}</td>
            <td>${setor ? "BENAR" : "X"}</td>
            <td>${ambil ? t.v3 : ""}</td>
            <td>${ambil ? t.v5 : ""}</td>
            <td>Rp. ${t.nominal.toLocaleString()}</td>
            <td>
              ${currentUser === "andi" && !tf ?
                `<button onclick="editTransaksi('${key}', ${JSON.stringify(t).replace(/"/g, '&quot;')})">Edit</button>
                 <button class="danger" onclick="hapusTransaksi('${key}')">Hapus</button>` : 
                (tf ? `<button class="danger" onclick="hapusTransaksi('${key}')">Hapus</button>` : "")}
            </td>
          `;
          tbodyR.appendChild(tr);

          if (ambil) {
            totalPengambilan += t.nominal;
            totalV3 += t.v3;
            totalV5 += t.v5;
            if (!agenMap[t.agen]) agenMap[t.agen] = { ambil: 0, setor: 0 };
            agenMap[t.agen].ambil += t.nominal;
          }
          if (setor) {
            totalSetoran += t.nominal;
            if (!agenMap[t.agen]) agenMap[t.agen] = { ambil: 0, setor: 0 };
            agenMap[t.agen].setor += t.nominal;
          }
          if (tf) {
            totalTf += t.nominal;
          }
        });

        Object.entries(agenMap).forEach(([id, data]) => {
          const nama = agenCache[id] || id;
          const utang = data.ambil - data.setor;
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${nama}</td>
            <td>Rp. ${data.ambil.toLocaleString()}</td>
            <td>Rp. ${data.setor.toLocaleString()}</td>
            <td style="color: ${utang > 0 ? 'red' : 'green'};">Rp. ${utang.toLocaleString()}</td>
          `;
          tbodyA.appendChild(tr);
        });

        document.getElementById("totalAmbilFooter").textContent = `Rp. ${totalPengambilan.toLocaleString()}`;
        document.getElementById("totalSetorFooter").textContent = `Rp. ${totalSetoran.toLocaleString()}`;
        document.getElementById("dropV3").textContent = totalV3;
        document.getElementById("dropV5").textContent = totalV5;

        db.ref(`data/${currentPeriode}/stok`).once("value", s => {
          const stok = s.val() || { v3: 0, v5: 0 };
          const sisaV3 = Math.max(0, stok.v3 - totalV3);
          const sisaV5 = Math.max(0, stok.v5 - totalV5);
          document.getElementById("sisaV3").textContent = sisaV3;
          document.getElementById("sisaV5").textContent = sisaV5;

          // âœ… Poin 2
          const totalYangBelumDiterima = Math.max(0, totalPengambilan - totalSetoran);
          document.getElementById("rek2").textContent = totalYangBelumDiterima.toLocaleString();

          // âœ… Poin 3
          document.getElementById("rek3").textContent = totalSetoran.toLocaleString();

          // âœ… Poin 1
          const totalStokAwal = (stok.v3 * 2550) + (stok.v5 * 4250);
          document.getElementById("rek1").textContent = totalStokAwal.toLocaleString();

          // âœ… Poin 4
          const totalGlobal = stok.v3 * HARGA_V3_GLOBAL + stok.v5 * HARGA_V5_GLOBAL;
          document.getElementById("rek4").textContent = totalGlobal.toLocaleString();

          // âœ… Poin 5: OTOMATIS DARI TOTAL TF
          document.getElementById("rek5").textContent = totalTf.toLocaleString();

          // âœ… Poin 6
          document.getElementById("rek6").textContent = (totalGlobal - totalTf).toLocaleString();

          // âœ… Poin 7
          const danaBarang = (sisaV3 * 2550) + (sisaV5 * 4250);
          document.getElementById("rek7").textContent = danaBarang.toLocaleString();
        });
      });
    }

    // âŒ Fungsi simpanRekapManual dihapus atau tidak dipakai
    // Karena semua rekap sekarang otomatis

    function editTransaksi(key, data) {
      if (confirm("Edit transaksi ini?")) {
        db.ref(`data/${currentPeriode}/transaksi/${key}`).remove().then(() => {
          if (data.jenis === "ambil") {
            document.getElementById("agenAmbil").value = data.agen;
            document.getElementById("v3Ambil").value = data.v3;
            document.getElementById("v5Ambil").value = data.v5;
            document.getElementById("tglAmbil").value = data.tgl;
          } else if (data.jenis === "setor") {
            document.getElementById("agenSetor").value = data.agen;
            document.getElementById("nominalSetor").value = data.nominal;
            document.getElementById("tglSetor").value = data.tgl;
          }
          simpanTransaksi(data.jenis);
        });
      }
    }

    function hapusTransaksi(key) {
      if (confirm("Hapus transaksi ini?")) {
        db.ref(`data/${currentPeriode}/transaksi/${key}`).remove();
      }
    }
  </script>
</body>
</html>
