
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistem Pembukuan Voucher</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
    }
    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .calendar-day:hover {
      background-color: #3b82f6;
      color: white;
    }
    .calendar-day.selected {
      background-color: #1d4ed8;
      color: white;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }
    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <!-- Login Screen -->
  <div id="loginScreen" class="min-h-screen flex items-center justify-center">
    <div class="bg-white p-8 rounded-xl shadow-2xl w-96">
      <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">Sistem Pembukuan</h1>
      <form id="loginForm" class="space-y-6">
        <div>
          <label for="username" class="block text-sm font-medium text-gray-700 mb-2">ID User</label>
          <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required />
        </div>
        <div>
          <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Sandi</label>
          <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required />
        </div>
        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 font-semibold">Masuk</button>
      </form>
    </div>
  </div>

  <!-- Main Application -->
  <div id="mainApp" class="hidden">
    <!-- Header -->
    <header class="bg-white shadow-lg">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-4">
          <h1 class="text-2xl font-bold text-gray-900">Sistem Pembukuan Voucher</h1>
          <div class="flex items-center space-x-4">
            <div id="connectionStatus" class="flex items-center space-x-2">
              <div id="statusIndicator" class="w-3 h-3 rounded-full bg-green-500"></div>
              <span id="statusText" class="text-sm text-gray-600">Real-time Aktif</span>
            </div>
            <span id="userInfo" class="text-gray-600"></span>
            <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-200">Keluar</button>
          </div>
        </div>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-gray-800">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex space-x-8">
          <button class="nav-btn text-white px-3 py-4 hover:bg-gray-700 transition duration-200" data-section="periode">Periode</button>
          <button class="nav-btn text-white px-3 py-4 hover:bg-gray-700 transition duration-200" data-section="catatan">Catatan</button>
          <button class="nav-btn text-white px-3 py-4 hover:bg-gray-700 transition duration-200" data-section="stok">Stok</button>
          <button class="nav-btn text-white px-3 py-4 hover:bg-gray-700 transition duration-200" data-section="agen">Daftar Agen</button>
          <button class="nav-btn text-white px-3 py-4 hover:bg-gray-700 transition duration-200" data-section="transaksi">Transaksi</button>
          <button class="nav-btn text-white px-3 py-4 hover:bg-gray-700 transition duration-200" data-section="riwayat">Riwayat</button>
        </div>
      </div>
    </nav>

    <!-- Content Sections -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Periode Section -->
      <section id="periode" class="content-section">
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">Manajemen Periode</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="currentPeriode" class="block text-sm font-medium text-gray-700 mb-2">Periode Aktif</label>
              <input type="text" id="currentPeriode" class="w-full px-4 py-3 border border-gray-300 rounded-lg" readonly />
            </div>
            <div id="addPeriodeSection" class="hidden">
              <label for="newPeriode" class="block text-sm font-medium text-gray-700 mb-2">Tambah Periode Baru</label>
              <div class="flex space-x-2">
                <input type="text" id="newPeriode" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg" placeholder="Masukkan periode baru" />
                <button id="savePeriode" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200">Simpan</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Catatan Section -->
      <section id="catatan" class="content-section hidden">
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">Catatan Penting</h2>
          <div class="space-y-4">
            <textarea id="catatanText" class="w-full h-40 px-4 py-3 border border-gray-300 rounded-lg resize-none" placeholder="Tulis catatan penting di sini..."></textarea>
            <button id="saveCatatan" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-200">Simpan Catatan</button>
          </div>
        </div>
      </section>

      <!-- Stok Section -->
      <section id="stok" class="content-section hidden">
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">Manajemen Stok Voucher</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- V3 Stok -->
            <div class="border border-gray-200 rounded-lg p-6">
              <h3 class="text-xl font-semibold text-gray-800 mb-4">Voucher V3</h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Stok Awal</label>
                  <input type="number" id="stokAwalV3" class="w-full px-4 py-3 border border-gray-300 rounded-lg" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Stok yang Telah di Drop</label>
                  <input type="number" id="stokDropV3" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Sisa Stok</label>
                  <input type="number" id="sisaStokV3" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly />
                </div>
              </div>
            </div>
            <!-- V5 Stok -->
            <div class="border border-gray-200 rounded-lg p-6">
              <h3 class="text-xl font-semibold text-gray-800 mb-4">Voucher V5</h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Stok Awal</label>
                  <input type="number" id="stokAwalV5" class="w-full px-4 py-3 border border-gray-300 rounded-lg" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Stok yang Telah di Drop</label>
                  <input type="number" id="stokDropV5" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Sisa Stok</label>
                  <input type="number" id="sisaStokV5" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly />
                </div>
              </div>
            </div>
          </div>
          <div id="stokActions" class="mt-6 hidden">
            <button id="saveStok" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200 mr-4">Simpan</button>
            <button id="editStok" class="bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 transition duration-200">Edit</button>
          </div>
        </div>
      </section>

      <!-- Agen Section -->
      <section id="agen" class="content-section hidden">
        <div class="bg-white rounded-xl shadow-lg p-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">Daftar Nama Agen</h2>
            <button id="addAgenBtn" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200 hidden">Tambah Agen</button>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full table-auto">
              <thead>
                <tr class="bg-gray-50">
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Agen</th>
                  <th id="agenActionHeader" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden">Aksi</th>
                </tr>
              </thead>
              <tbody id="agenList" class="bg-white divide-y divide-gray-200"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Transaksi Section -->
      <section id="transaksi" class="content-section hidden">
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">Transaksi</h2>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Pengambilan -->
            <div class="border border-gray-200 rounded-lg p-6">
              <h3 class="text-xl font-semibold text-gray-800 mb-4">Pengambilan</h3>
              <form id="pengambilanForm" class="space-y-4">
                <div>
                  <label for="agenPengambilan" class="block text-sm font-medium text-gray-700 mb-2">Nama Agen</label>
                  <select id="agenPengambilan" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required>
                    <option value="">Pilih Agen</option>
                  </select>
                </div>
                <div>
                  <label for="tanggalPengambilan" class="block text-sm font-medium text-gray-700 mb-2">Tanggal Pengambilan</label>
                  <input type="text" id="tanggalPengambilan" class="w-full px-4 py-3 border border-gray-300 rounded-lg cursor-pointer" readonly placeholder="Klik untuk pilih tanggal" required />
                </div>
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label for="jumlahV3" class="block text-sm font-medium text-gray-700 mb-2">Jumlah V3</label>
                    <input type="number" id="jumlahV3" class="w-full px-4 py-3 border border-gray-300 rounded-lg" min="0" value="0" />
                  </div>
                  <div>
                    <label for="jumlahV5" class="block text-sm font-medium text-gray-700 mb-2">Jumlah V5</label>
                    <input type="number" id="jumlahV5" class="w-full px-4 py-3 border border-gray-300 rounded-lg" min="0" value="0" />
                  </div>
                </div>
                <div>
                  <label for="totalHarga" class="block text-sm font-medium text-gray-700 mb-2">Total Harga</label>
                  <input type="text" id="totalHarga" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly />
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200">Simpan Pengambilan</button>
              </form>
            </div>

            <!-- Penyetoran -->
            <div class="border border-gray-200 rounded-lg p-6">
              <h3 class="text-xl font-semibold text-gray-800 mb-4">Penyetoran</h3>
              <form id="penyetoranForm" class="space-y-4">
                <div>
                  <label for="agenPenyetoran" class="block text-sm font-medium text-gray-700 mb-2">Nama Agen</label>
                  <select id="agenPenyetoran" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required>
                    <option value="">Pilih Agen</option>
                  </select>
                </div>
                <div>
                  <label for="tanggalPenyetoran" class="block text-sm font-medium text-gray-700 mb-2">Tanggal Penyetoran</label>
                  <input type="text" id="tanggalPenyetoran" class="w-full px-4 py-3 border border-gray-300 rounded-lg cursor-pointer" readonly placeholder="Klik untuk pilih tanggal" required />
                </div>
                <div>
                  <label for="jumlahSetoran" class="block text-sm font-medium text-gray-700 mb-2">Jumlah Setoran</label>
                  <input type="number" id="jumlahSetoran" class="w-full px-4 py-3 border border-gray-300 rounded-lg" min="0" required />
                </div>
                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-200">Simpan Penyetoran</button>
              </form>
            </div>
          </div>
        </div>
      </section>

      <!-- Riwayat Section -->
      <section id="riwayat" class="content-section hidden">
        <div class="space-y-8">
          <!-- Rekap Per Agen -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Rekap Transaksi Per Agen</h3>
            <div class="overflow-x-auto">
              <table class="w-full table-auto text-xs sm:text-sm">
                <thead>
                  <tr class="bg-gray-50">
                    <th class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Agen</th>
                    <th class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Pengambilan</th>
                    <th class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Setoran</th>
                    <th class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sisa Utang</th>
                  </tr>
                </thead>
                <tbody id="rekapAgenList" class="bg-white divide-y divide-gray-200"></tbody>
              </table>
            </div>
          </div>

          <!-- Rekap Keseluruhan -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Rekap Transaksi Keseluruhan</h3>
            <div class="overflow-x-auto">
              <table class="w-full table-auto text-xs sm:text-sm">
                <thead>
                  <tr class="bg-gray-50">
                    <th class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                    <th class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Agen</th>
                    <th class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pengambilan</th>
                    <th class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Setoran</th>
                    <th class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">V3</th>
                    <th class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">V5</th>
                    <th class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nominal</th>
                  </tr>
                </thead>
                <tbody id="rekapKeseluruhanList" class="bg-white divide-y divide-gray-200"></tbody>
                <tfoot>
                  <tr class="bg-gray-100 font-semibold">
                    <td colspan="6" class="px-3 py-2 text-xs sm:px-6 sm:py-3 sm:text-sm text-right">Total Pengambilan:</td>
                    <td id="totalPengambilan" class="px-3 py-2 text-xs sm:px-6 sm:py-3 sm:text-sm">Rp 0</td>
                  </tr>
                  <tr class="bg-gray-200 font-semibold">
                    <td colspan="6" class="px-3 py-2 text-xs sm:px-6 sm:py-3 sm:text-sm text-right">Total Setoran:</td>
                    <td id="totalSetoran" class="px-3 py-2 text-xs sm:px-6 sm:py-3 sm:text-sm">Rp 0</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>

          <!-- Rekap Menyeluruh -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Rekap Menyeluruh</h3>
            <div class="overflow-x-auto">
              <table class="w-full table-auto text-xs sm:text-sm">
                <thead>
                  <tr class="bg-gray-50">
                    <th class="px-2 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Keseluruhan (Stok Awal)</th>
                    <th class="px-2 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total yang Belum Diterima</th>
                    <th class="px-2 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total yang Sudah Diterima</th>
                    <th class="px-2 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total yang Akan di TF ke Global</th>
                    <th class="px-2 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total yang Sudah di TF ke Global</th>
                    <th class="px-2 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Sisa yang Belum di TF</th>
                    <th class="px-2 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Dana dengan Sifat Barang</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="bg-white">
                    <td id="totalStokAwal" class="px-2 py-2 sm:px-6 sm:py-4 whitespace-nowrap">Rp 0</td>
                    <td id="totalBelumDiterima" class="px-2 py-2 sm:px-6 sm:py-4 whitespace-nowrap">Rp 0</td>
                    <td id="totalSudahDiterima" class="px-2 py-2 sm:px-6 sm:py-4 whitespace-nowrap">Rp 0</td>
                    <td id="totalAkanTF" class="px-2 py-2 sm:px-6 sm:py-4 whitespace-nowrap">Rp 0</td>
                    <td class="px-2 py-2 sm:px-6 sm:py-4 whitespace-nowrap">
                      <input type="number" id="totalSudahTF" class="w-full px-2 py-1 sm:px-3 sm:py-2 border border-gray-300 rounded text-xs sm:text-sm" placeholder="Input manual" />
                    </td>
                    <td id="totalSisaTF" class="px-2 py-2 sm:px-6 sm:py-4 whitespace-nowrap">Rp 0</td>
                    <td id="totalDanaBarang" class="px-2 py-2 sm:px-6 sm:py-4 whitespace-nowrap">Rp 0</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button id="updateRekapMenyeluruh" class="mt-4 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-200">Update Rekap</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Calendar Modal -->
  <div id="calendarModal" class="modal">
    <div class="bg-white rounded-xl shadow-2xl p-6 w-96">
      <div class="flex justify-between items-center mb-4">
        <button id="prevMonth" class="text-gray-600 hover:text-gray-800"><</button>
        <h3 id="calendarTitle" class="text-lg font-semibold"></h3>
        <button id="nextMonth" class="text-gray-600 hover:text-gray-800">></button>
      </div>
      <div class="calendar-grid text-center text-sm">
        <div class="font-semibold text-gray-600 py-2">Min</div>
        <div class="font-semibold text-gray-600 py-2">Sen</div>
        <div class="font-semibold text-gray-600 py-2">Sel</div>
        <div class="font-semibold text-gray-600 py-2">Rab</div>
        <div class="font-semibold text-gray-600 py-2">Kam</div>
        <div class="font-semibold text-gray-600 py-2">Jum</div>
        <div class="font-semibold text-gray-600 py-2">Sab</div>
      </div>
      <div id="calendarDays" class="calendar-grid text-center text-sm mt-2"></div>
      <div class="flex justify-end mt-4 space-x-2">
        <button id="cancelCalendar" class="px-4 py-2 text-gray-600 hover:text-gray-800">Batal</button>
        <button id="confirmCalendar" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Pilih</button>
      </div>
    </div>
  </div>

  <!-- Add Agen Modal -->
  <div id="addAgenModal" class="modal">
    <div class="bg-white rounded-xl shadow-2xl p-6 w-96">
      <h3 class="text-lg font-semibold mb-4">Tambah Agen Baru</h3>
      <form id="addAgenForm" class="space-y-4">
        <div>
          <label for="newAgenId" class="block text-sm font-medium text-gray-700 mb-2">ID Agen</label>
          <input type="text" id="newAgenId" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required />
        </div>
        <div>
          <label for="newAgenName" class="block text-sm font-medium text-gray-700 mb-2">Nama Agen</label>
          <input type="text" id="newAgenName" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required />
        </div>
        <div class="flex justify-end space-x-2">
          <button type="button" id="cancelAddAgen" class="px-4 py-2 text-gray-600 hover:text-gray-800">Batal</button>
          <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Simpan</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC45P_1xbNL8zi3e0aS4kHkIGvRvGEAmwM",
      authDomain: "takkoandi-8e99e.firebaseapp.com",
      databaseURL: "https://takkoandi-8e99e-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "takkoandi-8e99e",
      storageBucket: "takkoandi-8e99e.firebasestorage.app",
      messagingSenderId: "117264025083",
      appId: "1:117264025083:web:8102fe737f7783e1b7b75e"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Data Storage
    let currentUser = null;
    let currentPeriode = "2024-001";
    let selectedDate = null;
    let calendarTarget = null;
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();

    // User credentials
    const users = {
      'andi': { password: '1981', role: 'admin', name: 'Andi (Admin)' },
      'risman': { password: 'sahrul', role: 'user', name: 'Risman' },
      'anto': { password: 'afzal', role: 'user', name: 'Anto' }
    };

    // Initial agents data
    let agents = {
      '001': 'nani', '002': 'rostini', '003': 'mila', '004': 'mira',
      '005': 'mama arham', '006': 'jusrawira', '007': 'putri', '008': 'ardila',
      '009': 'sulaeman', '010': 'ira', '011': 'jusriadi', '012': 'ricky',
      '013': 'risman', '014': 'afzal', '015': 'rika', '016': 'ayu',
      '017': 'hasna', '018': 'asnita', '019': 'nisma', '020': 'ennar',
      '021': 'nailah', '022': 'ady', '023': 'radiah'
    };

    // Data storage
    let stokData = { v3: { awal: 0, drop: 0 }, v5: { awal: 0, drop: 0 } };
    let transactions = [];
    let notes = '';

    // Pricing constants
    const HARGA_V3_AGEN = 2550;
    const HARGA_V5_AGEN = 4250;
    const HARGA_V3_GLOBAL = 2400;
    const HARGA_V5_GLOBAL = 4000;

    // Initialize app
    document.addEventListener('DOMContentLoaded', function () {
      initializeApp();
    });

    function initializeApp() {
      document.getElementById('loginForm').addEventListener('submit', handleLogin);
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', (e) => showSection(e.target.dataset.section));
      });
      document.getElementById('logoutBtn').addEventListener('click', logout);
      setupCalendar();
      setupForms();
      loadData();
    }

    function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      if (users[username] && users[username].password === password) {
        currentUser = { username, ...users[username] };
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        document.getElementById('userInfo').textContent = currentUser.name;
        setupRealtimeListeners();
        setupUserInterface();
        showSection('periode');
        showNotification(`Selamat datang, ${currentUser.name}! Sistem real-time aktif.`, 'success');
      } else {
        showNotification('ID User atau sandi salah!', 'error');
      }
    }

    function setupUserInterface() {
      const isAdmin = currentUser.role === 'admin';
      document.getElementById('addPeriodeSection').classList.toggle('hidden', !isAdmin);
      document.getElementById('stokActions').classList.toggle('hidden', !isAdmin);
      document.getElementById('addAgenBtn').classList.toggle('hidden', !isAdmin);
      document.getElementById('agenActionHeader').classList.toggle('hidden', !isAdmin);
      document.getElementById('currentPeriode').value = currentPeriode;
      if (isAdmin) {
        document.getElementById('savePeriode').addEventListener('click', savePeriode);
      }
      loadAgents();
      loadStokData();
    }

    function showSection(sectionName) {
      document.querySelectorAll('.content-section').forEach(section => section.classList.add('hidden'));
      document.getElementById(sectionName).classList.remove('hidden');
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('bg-gray-700'));
      document.querySelector(`[data-section="${sectionName}"]`).classList.add('bg-gray-700');
      if (sectionName === 'riwayat') {
        updateRiwayat();
      }
    }

    function setupCalendar() {
      document.getElementById('tanggalPengambilan').addEventListener('click', () => openCalendar('tanggalPengambilan'));
      document.getElementById('tanggalPenyetoran').addEventListener('click', () => openCalendar('tanggalPenyetoran'));
      document.getElementById('prevMonth').addEventListener('click', () => changeMonth(-1));
      document.getElementById('nextMonth').addEventListener('click', () => changeMonth(1));
      document.getElementById('cancelCalendar').addEventListener('click', closeCalendar);
      document.getElementById('confirmCalendar').addEventListener('click', confirmDate);
    }

    function openCalendar(targetId) {
      calendarTarget = targetId;
      renderCalendar();
      document.getElementById('calendarModal').classList.add('show');
    }

    function closeCalendar() {
      document.getElementById('calendarModal').classList.remove('show');
      selectedDate = null;
    }

    function changeMonth(delta) {
      currentMonth += delta;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
    }

    function renderCalendar() {
      const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
        'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
      document.getElementById('calendarTitle').textContent = `${monthNames[currentMonth]} ${currentYear}`;
      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      const calendarDays = document.getElementById('calendarDays');
      calendarDays.innerHTML = '';
      for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day';
        calendarDays.appendChild(emptyDay);
      }
      for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day bg-gray-100 hover:bg-blue-500';
        dayElement.textContent = day;
        dayElement.addEventListener('click', () => selectDate(day));
        calendarDays.appendChild(dayElement);
      }
    }

    function selectDate(day) {
      document.querySelectorAll('.calendar-day.selected').forEach(el => el.classList.remove('selected'));
      event.target.classList.add('selected');
      selectedDate = new Date(currentYear, currentMonth, day);
    }

    function confirmDate() {
      if (selectedDate && calendarTarget) {
        const formattedDate = `${selectedDate.getDate().toString().padStart(2, '0')}/${(selectedDate.getMonth() + 1).toString().padStart(2, '0')}/${selectedDate.getFullYear()}`;
        document.getElementById(calendarTarget).value = formattedDate;
        closeCalendar();
      }
    }

    function setupForms() {
      document.getElementById('saveCatatan').addEventListener('click', saveCatatan);
      if (currentUser && currentUser.role === 'admin') {
        document.getElementById('saveStok').addEventListener('click', saveStok);
        document.getElementById('editStok').addEventListener('click', editStok);
      }
      document.getElementById('addAgenBtn').addEventListener('click', () => {
        document.getElementById('addAgenModal').classList.add('show');
      });
      document.getElementById('cancelAddAgen').addEventListener('click', () => {
        document.getElementById('addAgenModal').classList.remove('show');
      });
      document.getElementById('addAgenForm').addEventListener('submit', addAgen);
      document.getElementById('pengambilanForm').addEventListener('submit', savePengambilan);
      document.getElementById('penyetoranForm').addEventListener('submit', savePenyetoran);
      document.getElementById('jumlahV3').addEventListener('input', calculateTotal);
      document.getElementById('jumlahV5').addEventListener('input', calculateTotal);
      document.getElementById('stokAwalV3').addEventListener('input', updateSisaStok);
      document.getElementById('stokAwalV5').addEventListener('input', updateSisaStok);
      document.getElementById('updateRekapMenyeluruh').addEventListener('click', updateRekapMenyeluruh);
      document.getElementById('totalSudahTF').addEventListener('input', updateRekapMenyeluruh);
    }

    function savePeriode() {
      const newPeriode = document.getElementById('newPeriode').value.trim();
      if (newPeriode) {
        currentPeriode = newPeriode;
        document.getElementById('currentPeriode').value = currentPeriode;
        document.getElementById('newPeriode').value = '';
        showNotification('Periode berhasil disimpan!', 'success');
        saveData();
      }
    }

    function saveCatatan() {
      notes = document.getElementById('catatanText').value;
      showNotification('Catatan berhasil disimpan!', 'success');
      saveData();
    }

    function loadAgents() {
      const agenList = document.getElementById('agenList');
      const agenPengambilan = document.getElementById('agenPengambilan');
      const agenPenyetoran = document.getElementById('agenPenyetoran');
      agenList.innerHTML = '';
      agenPengambilan.innerHTML = '<option value="">Pilih Agen</option>';
      agenPenyetoran.innerHTML = '<option value="">Pilih Agen</option>';
      Object.entries(agents).forEach(([id, name]) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${id}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${name}</td>
          ${currentUser.role === 'admin' ? `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            <button onclick="editAgen('${id}')" class="text-blue-600 hover:text-blue-900 mr-2">Edit</button>
            <button onclick="deleteAgen('${id}')" class="text-red-600 hover:text-red-900">Hapus</button>
          </td>` : ''}
        `;
        agenList.appendChild(row);
        const option1 = document.createElement('option');
        option1.value = name;
        option1.textContent = `${id} - ${name}`;
        agenPengambilan.appendChild(option1);
        const option2 = document.createElement('option');
        option2.value = name;
        option2.textContent = `${id} - ${name}`;
        agenPenyetoran.appendChild(option2);
      });
    }

    function addAgen(e) {
      e.preventDefault();
      const id = document.getElementById('newAgenId').value.trim();
      const name = document.getElementById('newAgenName').value.trim();
      if (agents[id]) {
        showNotification('ID agen sudah ada!', 'error');
        return;
      }
      agents[id] = name;
      loadAgents();
      document.getElementById('addAgenModal').classList.remove('show');
      document.getElementById('addAgenForm').reset();
      showNotification('Agen berhasil ditambahkan!', 'success');
      saveData();
    }

    function editAgen(id) {
      const newName = prompt('Masukkan nama baru:', agents[id]);
      if (newName && newName.trim()) {
        agents[id] = newName.trim();
        loadAgents();
        showNotification('Agen berhasil diupdate!', 'success');
        saveData();
      }
    }

    function deleteAgen(id) {
      if (confirm(`Hapus agen ${agents[id]}?`)) {
        delete agents[id];
        loadAgents();
        showNotification('Agen berhasil dihapus!', 'success');
        saveData();
      }
    }

    function loadStokData() {
      calculateStokDrop();
      document.getElementById('stokAwalV3').value = stokData.v3.awal || 0;
      document.getElementById('stokAwalV5').value = stokData.v5.awal || 0;
      document.getElementById('stokDropV3').value = stokData.v3.drop || 0;
      document.getElementById('stokDropV5').value = stokData.v5.drop || 0;
      const sisaV3 = Math.max(0, (stokData.v3.awal || 0) - (stokData.v3.drop || 0));
      const sisaV5 = Math.max(0, (stokData.v5.awal || 0) - (stokData.v5.drop || 0));
      document.getElementById('sisaStokV3').value = sisaV3;
      document.getElementById('sisaStokV5').value = sisaV5;
    }

    function saveStok() {
      stokData.v3.awal = parseInt(document.getElementById('stokAwalV3').value) || 0;
      stokData.v5.awal = parseInt(document.getElementById('stokAwalV5').value) || 0;

      // ❌ TIDAK LAGI MENGUNCI STOK AWAL
      // document.getElementById('stokAwalV3').readonly', true);
      // document.getElementById('stokAwalV5').readonly', true);

      calculateStokDrop();
      loadStokData();
      updateRiwayat();
      showNotification('Stok berhasil disimpan!', 'success');
      saveData();
    }

    function editStok() {
      // ❌ TIDAK PERLU UNLOCK KARENA FIELD TIDAK PERNAH DIKUNCI
      showNotification('Stok awal selalu bisa diedit. Ubah lalu klik Simpan.', 'info');
    }

    function calculateStokDrop() {
      let totalV3 = 0, totalV5 = 0;
      transactions.forEach(transaction => {
        if (transaction.type === 'pengambilan') {
          totalV3 += transaction.v3 || 0;
          totalV5 += transaction.v5 || 0;
        }
      });
      stokData.v3.drop = totalV3;
      stokData.v5.drop = totalV5;
    }

    function calculateTotal() {
      const v3 = parseInt(document.getElementById('jumlahV3').value) || 0;
      const v5 = parseInt(document.getElementById('jumlahV5').value) || 0;
      const total = (v3 * HARGA_V3_AGEN) + (v5 * HARGA_V5_AGEN);
      document.getElementById('totalHarga').value = `Rp ${total.toLocaleString('id-ID')}`;
    }

    function updateSisaStok() {
      const stokAwalV3 = parseInt(document.getElementById('stokAwalV3').value) || 0;
      const stokAwalV5 = parseInt(document.getElementById('stokAwalV5').value) || 0;
      calculateStokDrop();
      const sisaV3 = Math.max(0, stokAwalV3 - (stokData.v3.drop || 0));
      const sisaV5 = Math.max(0, stokAwalV5 - (stokData.v5.drop || 0));
      document.getElementById('sisaStokV3').value = sisaV3;
      document.getElementById('sisaStokV5').value = sisaV5;
      document.getElementById('stokDropV3').value = stokData.v3.drop || 0;
      document.getElementById('stokDropV5').value = stokData.v5.drop || 0;
    }

    function savePengambilan(e) {
      e.preventDefault();
      const agen = document.getElementById('agenPengambilan').value;
      const tanggal = document.getElementById('tanggalPengambilan').value;
      const v3 = parseInt(document.getElementById('jumlahV3').value) || 0;
      const v5 = parseInt(document.getElementById('jumlahV5').value) || 0;
      if (!agen || !tanggal) {
        showNotification('Mohon lengkapi semua field!', 'error');
        return;
      }
      const total = (v3 * HARGA_V3_AGEN) + (v5 * HARGA_V5_AGEN);
      const transaction = {
        id: Date.now(),
        type: 'pengambilan',
        agen,
        tanggal,
        v3,
        v5,
        total,
        timestamp: new Date()
      };
      transactions.push(transaction);
      calculateStokDrop();
      loadStokData();
      updateRiwayat();
      document.getElementById('pengambilanForm').reset();
      showNotification('Pengambilan berhasil disimpan!', 'success');
      saveData();
    }

    function savePenyetoran(e) {
      e.preventDefault();
      const agen = document.getElementById('agenPenyetoran').value;
      const tanggal = document.getElementById('tanggalPenyetoran').value;
      const jumlah = parseInt(document.getElementById('jumlahSetoran').value) || 0;
      if (!agen || !tanggal || jumlah <= 0) {
        showNotification('Mohon lengkapi semua field!', 'error');
        return;
      }
      const transaction = {
        id: Date.now(),
        type: 'penyetoran',
        agen,
        tanggal,
        jumlah,
        timestamp: new Date()
      };
      transactions.push(transaction);
      updateRiwayat();
      document.getElementById('penyetoranForm').reset();
      showNotification('Penyetoran berhasil disimpan!', 'success');
      saveData();
    }

    function updateRiwayat() {
      updateRekapAgen();
      updateRekapKeseluruhan();
      updateRekapMenyeluruh();
    }

    function updateRekapAgen() {
      const rekapAgenList = document.getElementById('rekapAgenList');
      rekapAgenList.innerHTML = '';
      const agenStats = {};
      Object.values(agents).forEach(name => {
        agenStats[name] = { pengambilan: 0, setoran: 0 };
      });
      transactions.forEach(transaction => {
        if (!agenStats[transaction.agen]) {
          agenStats[transaction.agen] = { pengambilan: 0, setoran: 0 };
        }
        if (transaction.type === 'pengambilan') {
          agenStats[transaction.agen].pengambilan += transaction.total;
        } else if (transaction.type === 'penyetoran') {
          agenStats[transaction.agen].setoran += transaction.jumlah;
        }
      });
      Object.entries(agenStats).forEach(([agen, stats]) => {
        const sisaUtang = stats.pengambilan - stats.setoran;
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="px-3 py-2 sm:px-6 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-900">${agen}</td>
          <td class="px-3 py-2 sm:px-6 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-900">Rp ${stats.pengambilan.toLocaleString('id-ID')}</td>
          <td class="px-3 py-2 sm:px-6 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-900">Rp ${stats.setoran.toLocaleString('id-ID')}</td>
          <td class="px-3 py-2 sm:px-6 sm:py-4 whitespace-nowrap text-xs sm:text-sm ${sisaUtang > 0 ? 'text-red-600' : 'text-green-600'}">Rp ${sisaUtang.toLocaleString('id-ID')}</td>
        `;
        rekapAgenList.appendChild(row);
      });
    }

    function updateRekapKeseluruhan() {
      const rekapKeseluruhanList = document.getElementById('rekapKeseluruhanList');
      rekapKeseluruhanList.innerHTML = '';
      let totalPengambilan = 0;
      let totalSetoran = 0;
      transactions.forEach(transaction => {
        const row = document.createElement('tr');
        if (transaction.type === 'pengambilan') {
          totalPengambilan += transaction.total;
          row.innerHTML = `
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-900">${transaction.tanggal}</td>
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-900">${transaction.agen}</td>
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-green-600"> ✓ </td>
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-400"> ✗ </td>
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-900">${transaction.v3}</td>
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-900">${transaction.v5}</td>
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-900">Rp ${transaction.total.toLocaleString('id-ID')}</td>
          `;
        } else {
          totalSetoran += transaction.jumlah;
          row.innerHTML = `
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-900">${transaction.tanggal}</td>
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-900">${transaction.agen}</td>
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-400"> ✗ </td>
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-green-600"> ✓ </td>
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-400">-</td>
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-400">-</td>
            <td class="px-3 py-2 text-xs sm:px-6 sm:py-4 sm:text-sm text-gray-900">Rp ${transaction.jumlah.toLocaleString('id-ID')}</td>
          `;
        }
        rekapKeseluruhanList.appendChild(row);
      });
      document.getElementById('totalPengambilan').textContent = `Rp ${totalPengambilan.toLocaleString('id-ID')}`;
      document.getElementById('totalSetoran').textContent = `Rp ${totalSetoran.toLocaleString('id-ID')}`;
    }

    function updateRekapMenyeluruh() {
      // ✅ PERBAIKAN RUMUS: (V3 × 2550) + (V5 × 4250)
      const totalStokAwal = (stokData.v3.awal * HARGA_V3_AGEN) + (stokData.v5.awal * HARGA_V5_AGEN);

      let totalPengambilan = 0;
      let totalSetoran = 0;
      transactions.forEach(transaction => {
        if (transaction.type === 'pengambilan') {
          totalPengambilan += transaction.total;
        } else if (transaction.type === 'penyetoran') {
          totalSetoran += transaction.jumlah;
        }
      });

      const totalBelumDiterima = totalPengambilan - totalSetoran;
      const totalSudahDiterima = totalSetoran;
      const totalAkanTF = (stokData.v3.awal * HARGA_V3_GLOBAL) + (stokData.v5.awal * HARGA_V5_GLOBAL);
      const totalSudahTF = parseInt(document.getElementById('totalSudahTF').value) || 0;
      const totalSisaTF = totalAkanTF - totalSudahTF;

      // ✅ PERBAIKAN: Dana sifat barang = sisa stok × harga agen
      const sisaStokV3 = Math.max(0, stokData.v3.awal - stokData.v3.drop);
      const sisaStokV5 = Math.max(0, stokData.v5.awal - stokData.v5.drop);
      const totalDanaBarang = (sisaStokV3 * HARGA_V3_AGEN) + (sisaStokV5 * HARGA_V5_AGEN);

      document.getElementById('totalStokAwal').innerHTML = `<span class="text-xs sm:text-sm">Rp ${totalStokAwal.toLocaleString('id-ID')}</span>`;
      document.getElementById('totalBelumDiterima').innerHTML = `<span class="text-xs sm:text-sm">Rp ${totalBelumDiterima.toLocaleString('id-ID')}</span>`;
      document.getElementById('totalSudahDiterima').innerHTML = `<span class="text-xs sm:text-sm">Rp ${totalSudahDiterima.toLocaleString('id-ID')}</span>`;
      document.getElementById('totalAkanTF').innerHTML = `<span class="text-xs sm:text-sm">Rp ${totalAkanTF.toLocaleString('id-ID')}</span>`;
      document.getElementById('totalSisaTF').innerHTML = `<span class="text-xs sm:text-sm">Rp ${totalSisaTF.toLocaleString('id-ID')}</span>`;
      document.getElementById('totalDanaBarang').innerHTML = `<span class="text-xs sm:text-sm">Rp ${totalDanaBarang.toLocaleString('id-ID')}</span>`;
    }

    function showNotification(message, type) {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 3000);
    }

    // Firebase Real-time Functions
    function saveData() {
      const data = {
        currentPeriode,
        agents,
        stokData,
        transactions,
        notes,
        lastUpdated: new Date().toISOString()
      };
      database.ref('pembukuanData').set(data)
        .then(() => console.log('Data berhasil disimpan ke Firebase'))
        .catch((error) => {
          console.error('Error menyimpan data:', error);
          showNotification('Gagal menyimpan data ke server!', 'error');
        });
    }

    function loadData() {
      database.ref('pembukuanData').once('value')
        .then((snapshot) => {
          const data = snapshot.val();
          if (data) {
            currentPeriode = data.currentPeriode || currentPeriode;
            agents = data.agents || agents;
            stokData = data.stokData || stokData;
            transactions = data.transactions || [];
            notes = data.notes || '';
            document.getElementById('catatanText').value = notes;
            if (currentUser) {
              loadAgents();
              loadStokData();
              updateRiwayat();
            }
          }
        })
        .catch((error) => {
          console.error('Error loading data:', error);
          loadDataFromLocalStorage();
        });
    }

    function loadDataFromLocalStorage() {
      const saved = localStorage.getItem('pembukuanData');
      if (saved) {
        const data = JSON.parse(saved);
        currentPeriode = data.currentPeriode || currentPeriode;
        agents = data.agents || agents;
        stokData = data.stokData || stokData;
        transactions = data.transactions || [];
        notes = data.notes || '';
        document.getElementById('catatanText').value = notes;
      }
    }

    function setupRealtimeListeners() {
      database.ref('.info/connected').on('value', (snapshot) => {
        const connected = snapshot.val();
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        if (connected) {
          statusIndicator.className = 'w-3 h-3 rounded-full bg-green-500';
          statusText.textContent = 'Real-time Aktif';
        } else {
          statusIndicator.className = 'w-3 h-3 rounded-full bg-red-500';
          statusText.textContent = 'Offline';
        }
      });

      database.ref('pembukuanData').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data && currentUser) {
          const oldTransactionCount = transactions.length;
          currentPeriode = data.currentPeriode || currentPeriode;
          agents = data.agents || agents;
          stokData = data.stokData || stokData;
          transactions = data.transactions || [];
          notes = data.notes || '';
          document.getElementById('catatanText').value = notes;
          document.getElementById('currentPeriode').value = currentPeriode;
          loadAgents();
          loadStokData();
          updateRiwayat();
          if (transactions.length !== oldTransactionCount && oldTransactionCount > 0) {
            showNotification('Data telah diperbarui secara real-time!', 'success');
          }
        }
      });
    }

    function logout() {
      database.ref('pembukuanData').off();
      database.ref('.info/connected').off();
      currentUser = null;
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('mainApp').classList.add('hidden');
      document.getElementById('loginForm').reset();
      showNotification('Berhasil keluar dari sistem', 'success');
    }
  </script>
</body>

</html>
